<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>1台トランシーバー</title>
<style>
body { font-family:sans-serif; text-align:center; padding:20px; }
button { font-size:22px; padding:25px; width:100%; }
#status { margin:20px; font-weight:bold; }
</style>
</head>
<body>

<div id="status">タップして開始</div>
<button id="talk">押して話す</button>

<script>
let ctx, mic, gain;

/* 初期化 */
async function init() {
  ctx = new (window.AudioContext||window.webkitAudioContext)();

  const stream = await navigator.mediaDevices.getUserMedia({
    audio:{
      echoCancellation:false,
      noiseSuppression:false,
      autoGainControl:false
    }
  });

  mic = ctx.createMediaStreamSource(stream);
  gain = ctx.createGain();
  gain.gain.value = 0; // ← 最初は完全停止

  mic.connect(gain).connect(ctx.destination);

  status.textContent = "✈️ 1台モード（一時停止OK）";
}

/* ユーザー操作で開始 */
document.body.addEventListener("click", async ()=>{
  if (!ctx) await init();
  if (ctx.state === "suspended") await ctx.resume();
},{once:true});

/* 押して話す（PTT） */
talk.onmousedown  = () => gain && (gain.gain.value = 1);
talk.onmouseup    = () => gain && (gain.gain.value = 0);
talk.ontouchstart = () => gain && (gain.gain.value = 1);
talk.ontouchend   = () => gain && (gain.gain.value = 0);
</script>

</body>
</html>
